@page "/confirmation/{OrderNumber}" // EKLENDİ
@using PizzaOrderApp.Models
@using PizzaOrderApp.Services
@using System.Globalization
@inject OrderService OrderService
@inject NavigationManager NavManager

<PageTitle>Sipariş Onayı - @OrderNumber</PageTitle>

@code {
    [Parameter]
    public string OrderNumber { get; set; } = string.Empty;

    private Order? confirmedOrder;

    protected override void OnInitialized()
    {
        confirmedOrder = OrderService.CurrentOrder;
        // Güvenlik kontrolü
        if (confirmedOrder == null || confirmedOrder.OrderNumber != OrderNumber || string.IsNullOrEmpty(OrderNumber))
        {
             confirmedOrder = null;
        }
    }
}

<div class="container mt-5 text-center">
    @if (confirmedOrder != null)
    {
        <div class="card p-5 shadow-lg bg-light confirmation-box">
            <h1 class="text-success mb-4">✔ Siparişiniz Onaylandı!</h1>
            <p class="lead mb-4">Teşekkür ederiz! Siparişiniz hazırlanmaya başlamıştır.</p>
            <h2 class="mb-4">Sipariş Numaranız: <span class="badge bg-primary p-3">@OrderNumber</span></h2>
            <div class="text-start mx-auto mt-3 mb-4" style="max-width: 450px; border-top: 1px solid #ddd; padding-top: 1rem;">
                <h5>Sipariş Detayları:</h5>
                <p class="mb-1"><strong>Pizza:</strong> @confirmedOrder.SelectedPizza?.Name (@confirmedOrder.SelectedSize?.Name)</p>
                @if (confirmedOrder.SelectedToppings.Any())
                { <p class="mb-1"><strong>Ek Malzemeler:</strong> @string.Join(", ", confirmedOrder.SelectedToppings)</p> }
                <p class="mb-1"><strong>Toplam Tutar:</strong> @confirmedOrder.TotalPrice.ToString("C2", new CultureInfo("tr-TR"))</p>
                <hr/>
                <p class="mb-1"><strong>Teslimat Adı:</strong> @confirmedOrder.CustomerInfo.Name</p>
                <p class="mb-1"><strong>Teslimat Adresi:</strong> @confirmedOrder.CustomerInfo.Address</p>
            </div>
            <button @onclick='() => NavManager.NavigateTo("/pizzas")' class="btn btn-warning btn-lg mt-4">
                Yeni Sipariş Oluştur
            </button>
        </div>
    }
    else
    {
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Geçersiz Sipariş Numarası!</h4>
            <p>Görüntülemeye çalıştığınız sipariş bulunamadı.</p>
            <hr>
            <button @onclick='() => NavManager.NavigateTo("/pizzas")' class="btn btn-secondary mt-3">
                Ana Sayfaya Dön
            </button>
        </div>
    }
</div>