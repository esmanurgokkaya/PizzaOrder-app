@page "/confirmation/{OrderNumber}" 
@using PizzaOrderApp.Models // Models namespace'i (Order sınıfı için)
@using PizzaOrderApp.Services // Services namespace'i (OrderService için)
@inject OrderService OrderService 
@inject NavigationManager NavManager

<PageTitle>Sipariş Onayı</PageTitle>

@code {
    // Dinamik rotadan gelen sipariş numarasını yakalar
    [Parameter]
    public string OrderNumber { get; set; } = string.Empty;
    
    // Onay anındaki sipariş detaylarını tutmak için
    private Order? confirmedOrder;

    // Sayfa yüklendiğinde çalışır
    protected override void OnInitialized()
    {
        // OrderService'teki CurrentOrder, HandleValidSubmit'te güncellendiği için
        // son sipariş bilgilerini içerir. Onu alıyoruz.
        confirmedOrder = OrderService.CurrentOrder;

        // Ekstra Güvenlik: Eğer OrderService'teki OrderNumber ile URL'deki uyuşmuyorsa
        // veya sipariş boşsa, ana sayfaya yönlendir (isteğe bağlı).
        if (confirmedOrder == null || confirmedOrder.OrderNumber != OrderNumber || string.IsNullOrEmpty(OrderNumber))
        {
             // NavManager.NavigateTo("/"); // Ana sayfaya veya hata sayfasına yönlendirme eklenebilir.
             // Şimdilik sadece confirmedOrder'ı null bırakıyoruz, @if bloğu mesajı gösterecek.
             confirmedOrder = null; 
        }
    }
}

<div class="container mt-5 text-center">
    
    @if (confirmedOrder != null)
    {
        @* Sipariş Başarılı Durumu *@
        <div class="card p-5 shadow-lg bg-light confirmation-box">
            <h1 class="text-success mb-4">✔ Siparişiniz Onaylandı!</h1>
            <p class="lead mb-4">Teşekkür ederiz! Siparişiniz en kısa sürede hazırlanacaktır.</p>
            
            <h2 class="mb-4">Sipariş Numaranız: <span class="badge bg-primary p-3">@OrderNumber</span></h2>

            @* Sipariş Özeti *@
            <div class="text-start mx-auto mt-3 mb-4" style="max-width: 450px; border-top: 1px solid #ddd; padding-top: 1rem;">
                <h5>Sipariş Detayları:</h5>
                <p class="mb-1"><strong>Pizza:</strong> @confirmedOrder.SelectedPizza?.Name (@confirmedOrder.SelectedSize?.Name)</p>
                @if (confirmedOrder.SelectedToppings.Any())
                {
                    <p class="mb-1"><strong>Ek Malzemeler:</strong> @string.Join(", ", confirmedOrder.SelectedToppings)</p>
                }
                <p class="mb-1"><strong>Toplam Tutar:</strong> @confirmedOrder.TotalPrice.ToString("C2")</p>
                <hr/>
                <p class="mb-1"><strong>Teslimat Adı:</strong> @confirmedOrder.CustomerInfo.Name</p>
                <p class="mb-1"><strong>Teslimat Adresi:</strong> @confirmedOrder.CustomerInfo.Address</p>
            </div>
            
            <button @onclick='() => NavManager.NavigateTo("/pizzas")' class="btn btn-warning btn-lg mt-4">
                Yeni Sipariş Oluştur
            </button>
        </div>
    }
    else
    {
        @* Hata veya Geçersiz Erişim Durumu *@
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Geçersiz Sipariş Numarası!</h4>
            <p>Görüntülemeye çalıştığınız sipariş bulunamadı veya bir hata oluştu.</p>
            <hr>
            <button @onclick='() => NavManager.NavigateTo("/pizzas")' class="btn btn-secondary mt-3">
                Ana Sayfaya Dön
            </button>
        </div>
    }
</div>