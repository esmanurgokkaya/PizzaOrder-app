@page "/confirmation/{OrderNumber}"
@using PizzaOrderApp.Models
@using PizzaOrderApp.Services
@using System.Globalization
@inject OrderService OrderService
@inject NavigationManager NavManager

@* Onay sayfası: URL'den alınan `OrderNumber` parametresi ile yerel depolamadan son kaydedilen sipariş okunur ve gösterilir. *@

<PageTitle>Sipariş Onayı - @OrderNumber</PageTitle>

@code {
    [Parameter]
    public string OrderNumber { get; set; } = string.Empty;

    private Order? confirmedOrder;

    protected override async Task OnInitializedAsync()
    {
        await OrderService.LoadLastOrderFromLocalStorageAsync();

        confirmedOrder = OrderService.CurrentOrder;

        if (confirmedOrder == null || string.IsNullOrEmpty(OrderNumber) || confirmedOrder.OrderNumber != OrderNumber)
        {
            confirmedOrder = null;
        }
    }
}

<div class="container confirmation-container">
    @if (confirmedOrder != null)
    {
        <div class="confirmation-success-wrapper">

            <div class="confirmation-card">
                <div class="card-header-custom">
                    <h1 class="confirmation-title">Siparişiniz Onaylandı!</h1>
                    <p class="confirmation-subtitle">Teşekkür ederiz! Siparişiniz hazırlanmaya başlamıştır.</p>
                </div>

                <div class="order-number-section">
                    <span class="order-number-label">Sipariş Numaranız</span>
                    <div class="order-number-badge">
                        <span class="order-number">@OrderNumber</span>
                    </div>
                </div>

                <div class="order-details-section">
                    <h5 class="section-title">
                        <i class="bi bi-list-check me-2"></i>Sipariş Detayları
                    </h5>
                    
                    <div class="detail-item">
                        <span class="detail-label">Pizza</span>
                        <span class="detail-value">@confirmedOrder.SelectedPizza?.Name (@confirmedOrder.SelectedSize?.Name)</span>
                    </div>

                    @if (confirmedOrder.SelectedToppings.Any())
                    {
                        <div class="detail-item">
                            <span class="detail-label">Ek Malzemeler</span>
                            <span class="detail-value">@string.Join(", ", confirmedOrder.SelectedToppings)</span>
                        </div>
                    }

                    <div class="detail-item total-item">
                        <span class="detail-label">Toplam Tutar</span>
                        <span class="detail-value total-price">@confirmedOrder.TotalPrice.ToString("C2", new CultureInfo("tr-TR"))</span>
                    </div>

                    <div class="divider"></div>

                    <h5 class="section-title mt-4">
                        <i class="bi bi-geo-alt-fill me-2"></i>Teslimat Bilgileri
                    </h5>

                    <div class="detail-item">
                        <span class="detail-label">Ad Soyad</span>
                        <span class="detail-value">@confirmedOrder.CustomerInfo.Name</span>
                    </div>

                    <div class="detail-item">
                        <span class="detail-label">Teslimat Adresi</span>
                        <span class="detail-value">@confirmedOrder.CustomerInfo.Address</span>
                    </div>
                </div>

                <div class="action-section">
                    <button @onclick='() => NavManager.NavigateTo("/pizzas")' class="btn btn-new-order">
                        <i class="bi bi-plus-circle me-2"></i>
                        Yeni Sipariş Oluştur
                    </button>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="error-wrapper">
            <div class="error-card">
                <h4 class="error-title">Geçersiz Sipariş Numarası!</h4>
                <p class="error-message">Görüntülemeye çalıştığınız sipariş bulunamadı.</p>
                <button @onclick='() => NavManager.NavigateTo("/pizzas")' class="btn btn-back-home">
                    <i class="bi bi-house-door me-2"></i>
                    Ana Sayfaya Dön
                </button>
            </div>
        </div>
    }
</div>