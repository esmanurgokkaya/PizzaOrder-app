@namespace PizzaOrderApp.Components
@using System.Globalization
@inject OrderService OrderService
@implements IDisposable
@inject NavigationManager NavManager

<div class="card shadow-sm order-summary-card">
    <div class="card-header summary-header">
        <h5 class="mb-0">üõí Sipari≈ü √ñzeti</h5>
    </div>
    <div class="card-body">
        @if (OrderService.CurrentOrder.SelectedPizza != null)
        {
            <h6>@OrderService.CurrentOrder.SelectedPizza.Name</h6>
            <ul class="list-unstyled small">
                <li><strong>Boyut:</strong> @(OrderService.CurrentOrder.SelectedSize?.Name ?? "Se√ßilmedi")</li>
                <li><strong>Ek Malzemeler:</strong> @(OrderService.CurrentOrder.SelectedToppings.Any() ? $"{OrderService.CurrentOrder.SelectedToppings.Count} adet (+{(OrderService.CurrentOrder.SelectedToppings.Count * 10).ToString("C2", new CultureInfo("tr-TR"))})" : "Yok")</li>
            </ul>
        }
        else
        { <p class="text-muted">L√ºtfen men√ºden bir pizza se√ßin.</p> }
    </div>
    <div class="card-footer d-flex justify-content-between align-items-center summary-footer">
        <span class="h6 mb-0">Toplam Tutar:</span>
        <span class="total-price h4 mb-0">@OrderService.CurrentOrder.TotalPrice.ToString("C2", new CultureInfo("tr-TR"))</span>
    </div>
   
    @if (!NavManager.Uri.EndsWith("/checkout", StringComparison.OrdinalIgnoreCase))
    {
        <div class="p-3">
            <button class="btn btn-primary w-100"
                    @onclick="GoToCheckout"
                    disabled="@(OrderService.CurrentOrder.SelectedSize == null)"
                    aria-label="√ñdemeye git">
                √ñdemeye Git
            </button>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    { OrderService.OnOrderStateChanged += OnOrderUpdated; }

    private void OnOrderUpdated()
    { InvokeAsync(StateHasChanged); } 

    private void GoToCheckout()
    { NavManager.NavigateTo("/checkout"); }

    public void Dispose() 
    { OrderService.OnOrderStateChanged -= OnOrderUpdated; }
}