@namespace PizzaOrderApp.Components
@using System.Globalization
@inject OrderService OrderService
@implements IDisposable
@inject NavigationManager NavManager

@* SipariÅŸ Ã¶zeti bileÅŸeni:
    - `OrderService.CurrentOrder` Ã¼zerinden seÃ§ili pizza, boyut ve ekstra malzemeler gÃ¶sterilir.
    - Toplam tutar `OrderService.CurrentOrder.TotalPrice` kullanÄ±larak gÃ¶rÃ¼ntÃ¼lenir (kÃ¼ltÃ¼re gÃ¶re biÃ§imlendirilir).
    - BileÅŸen, `OrderService.OnOrderStateChanged` olayÄ±na abone olarak gÃ¼ncellemeleri dinler ve Dispose iÃ§inde aboneliÄŸi kaldÄ±rÄ±r.
    - Checkout'a gitme butonu, boyut seÃ§ilmemiÅŸse devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r. *@

<div class="card shadow-sm order-summary-card">
    <div class="card-header summary-header">
        <h5 class="mb-0">ğŸ›’ SipariÅŸ Ã–zeti</h5>
    </div>
    <div class="card-body">
        @if (OrderService.CurrentOrder.SelectedPizza != null)
        {
            <h6>@OrderService.CurrentOrder.SelectedPizza.Name</h6>
            <ul class="list-unstyled small">
                <li><strong>Boyut:</strong> @(OrderService.CurrentOrder.SelectedSize?.Name ?? "SeÃ§ilmedi")</li>
                <li><strong>Ek Malzemeler:</strong> @(OrderService.CurrentOrder.SelectedToppings.Any() ? $"{OrderService.CurrentOrder.SelectedToppings.Count} adet (+{(OrderService.CurrentOrder.SelectedToppings.Count * 10).ToString("C2", new CultureInfo("tr-TR"))})" : "Yok")</li>
            </ul>
        }
        else
        { <p class="text-muted">LÃ¼tfen menÃ¼den bir pizza seÃ§in.</p> }
    </div>
    <div class="card-footer d-flex justify-content-between align-items-center summary-footer">
        <span class="h6 mb-0">Toplam Tutar:</span>
        <span class="total-price h4 mb-0">@OrderService.CurrentOrder.TotalPrice.ToString("C2", new CultureInfo("tr-TR"))</span>
    </div>
   
    @if (!NavManager.Uri.EndsWith("/checkout", StringComparison.OrdinalIgnoreCase))
    {
        <div class="p-3">
            <button class="btn btn-primary w-100"
                    @onclick="GoToCheckout"
                    disabled="@(OrderService.CurrentOrder.SelectedSize == null)"
                    aria-label="Ã–demeye git">
                Ã–demeye Git
            </button>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    { OrderService.OnOrderStateChanged += OnOrderUpdated; }

    private void OnOrderUpdated()
    { InvokeAsync(StateHasChanged); } 

    private void GoToCheckout()
    { NavManager.NavigateTo("/checkout"); }

    public void Dispose() 
    { OrderService.OnOrderStateChanged -= OnOrderUpdated; }
}