@* @using PizzaOrder_app.Models - _Imports.razor'da var *@
@* @using PizzaOrder_app.Services - _Imports.razor'da var *@
@namespace PizzaOrderApp.Components
@inject OrderService OrderService
@implements IDisposable
@inject NavigationManager NavManager

<div class="card shadow-sm order-summary-card">
    <div class="card-header summary-header">
        <h5 class="mb-0">ðŸ›’ SipariÅŸ Ã–zeti</h5>
    </div>
    <div class="card-body">
        @if (OrderService.CurrentOrder.SelectedPizza != null)
        {
            <h6>@OrderService.CurrentOrder.SelectedPizza.Name</h6>
            <ul class="list-unstyled small">
                <li><strong>Boyut:</strong> @(OrderService.CurrentOrder.SelectedSize?.Name ?? "SeÃ§ilmedi")</li>
                <li><strong>Ek Malzemeler:</strong> @(OrderService.CurrentOrder.SelectedToppings.Any() ? $"{OrderService.CurrentOrder.SelectedToppings.Count} adet (+{(OrderService.CurrentOrder.SelectedToppings.Count * 10).ToString("C2")})" : "Yok")</li>
            </ul>
        }
        else
        { <p class="text-muted">LÃ¼tfen menÃ¼den bir pizza seÃ§in.</p> }
    </div>
    <div class="card-footer d-flex justify-content-between align-items-center summary-footer">
        <span class="h6 mb-0">Toplam Tutar:</span>
        <span class="total-price h4 mb-0">@OrderService.CurrentOrder.TotalPrice.ToString("C2")</span>
    </div>
    @* Show a small checkout link/button when the user is not currently on the checkout page.
       This prevents a duplicate large button on the checkout page while still allowing
       users to navigate there from previews (e.g. pizza details). *@
    @if (!NavManager.Uri.EndsWith("/checkout", StringComparison.OrdinalIgnoreCase))
    {
        <div class="p-3">
            <button class="btn btn-primary w-100"
                    @onclick="GoToCheckout"
                    disabled="@(OrderService.CurrentOrder.SelectedSize == null)"
                    aria-label="Ã–demeye git">
                Ã–demeye Git
            </button>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    { OrderService.OnOrderStateChanged += OnOrderUpdated; }

    private void OnOrderUpdated()
    { InvokeAsync(StateHasChanged); } // GÃ¼ncelleme iÃ§in InvokeAsync kullanmak daha gÃ¼venli

    private void GoToCheckout()
    { NavManager.NavigateTo("/checkout"); }

    public void Dispose() // Bellek sÄ±zÄ±ntÄ±sÄ±nÄ± Ã¶nler
    { OrderService.OnOrderStateChanged -= OnOrderUpdated; }
}