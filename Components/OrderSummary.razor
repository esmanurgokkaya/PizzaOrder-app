@using PizzaOrderApp.Models // Models namespace'i gerekli
@using PizzaOrderApp.Services // Services namespace'i gerekli
@namespace PizzaOrderApp.Components
@inject OrderService OrderService
@implements IDisposable 
@inject NavigationManager NavManager

<div class="card shadow-sm order-summary-card">
    @* --- Geri kalan HTML ve @code bloÄŸu Ã¶nceki hatasÄ±z sÃ¼rÃ¼mdeki gibi --- *@
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">ðŸ›’ SipariÅŸ Ã–zeti</h5>
    </div>
    <div class="card-body">
        @if (OrderService.CurrentOrder.SelectedPizza != null)
        {
            <h6>@OrderService.CurrentOrder.SelectedPizza.Name</h6>
            <ul class="list-unstyled small">
                <li><strong>Boyut:</strong> @OrderService.CurrentOrder.SelectedSize?.Name</li>
                <li><strong>Ek Malzemeler:</strong> @(OrderService.CurrentOrder.SelectedToppings.Count > 0 ? $"{OrderService.CurrentOrder.SelectedToppings.Count} adet" : "Yok")</li>
            </ul>
        }
        else
        {
            <p class="text-muted">LÃ¼tfen menÃ¼den bir pizza seÃ§imi yapÄ±n.</p>
        }
    </div>

    <div class="card-footer d-flex justify-content-between align-items-center bg-light">
        <span class="h5 mb-0">Toplam Tutar:</span>
        <span class="total-price h4 mb-0 text-success">
            @OrderService.CurrentOrder.TotalPrice.ToString("C2")
        </span>
    </div>

    <div class="p-3">
        <button class="btn btn-lg btn-success w-100" 
                @onclick="GoToCheckout"
                disabled="@(OrderService.CurrentOrder.SelectedSize == null)">
            SipariÅŸi Tamamla (@OrderService.CurrentOrder.TotalPrice.ToString("C2"))
        </button>
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        OrderService.OnOrderStateChanged += OnOrderUpdated; 
    }

    private void OnOrderUpdated()
    {
        InvokeAsync(StateHasChanged); // StateHasChanged'i InvokeAsync ile Ã§aÄŸÄ±rmak daha gÃ¼venlidir.
    }

    private void GoToCheckout()
    {
        NavManager.NavigateTo("/checkout");
    }

    public void Dispose()
    {
        OrderService.OnOrderStateChanged -= OnOrderUpdated;
    }
}